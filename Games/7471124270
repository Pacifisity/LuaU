-- https://www.roblox.com/games/77742675853993

local win = loadstring(
    game:HttpGet(
        'https://raw.githubusercontent.com/Pacifisity/LuaU/refs/heads/main/Sage.lua'
    )
)()

local Players = game:GetService('Players')
local lp = Players.LocalPlayer
local spamAmount = 1 -- default spam amount

-------------------------------------------------------
-- HELPERS
-------------------------------------------------------
local function getHrp()
    local char = lp.Character or lp.CharacterAdded:Wait()
    return char:WaitForChild('HumanoidRootPart')
end

local function tp(cf)
    getHrp().CFrame = cf
end

-------------------------------------------------------
-- AUTO CONFESSIONAL LOOPS
-------------------------------------------------------
local autoPunish = false
local punishThread = nil

local autoForgive = false
local forgiveThread = nil

-------------------------------------------------------
-- PUNISH LOOP
-------------------------------------------------------
local function runPunishLoop()
    punishThread = task.spawn(function()
        while autoPunish do
            local originalCF = getHrp().CFrame

            for _, booth in ipairs(workspace.ConfessionalBooths:GetChildren()) do
                if not autoPunish then
                    break
                end

                local button = booth:FindFirstChild('punishButton')
                if button and button:IsA('BasePart') then
                    if button.BrickColor == BrickColor.new('Really red') then
                        local click =
                            button:FindFirstChildWhichIsA('ClickDetector')
                        if click then
                            tp(
                                CFrame.new(
                                    button.Position - Vector3.new(0, 3, 0)
                                )
                            )
                            task.wait(0.1)

                            fireclickdetector(click)

                            tp(originalCF)
                        end
                    end
                end
            end

            task.wait(0.15)
        end
    end)
end

-------------------------------------------------------
-- FORGIVE LOOP
-------------------------------------------------------
local function runForgiveLoop()
    forgiveThread = task.spawn(function()
        while autoForgive do
            local originalCF = getHrp().CFrame

            for _, booth in ipairs(workspace.ConfessionalBooths:GetChildren()) do
                if not autoForgive then
                    break
                end

                local button = booth:FindFirstChild('forgiveButton')
                if button and button:IsA('BasePart') then
                    if button.BrickColor == BrickColor.new('Toothpaste') then
                        local click =
                            button:FindFirstChildWhichIsA('ClickDetector')
                        if click then
                            tp(
                                CFrame.new(
                                    button.Position - Vector3.new(0, 3, 0)
                                )
                            )
                            task.wait(0.1)

                            -- spam 100x
                            for i = 1, 100 do
                                fireclickdetector(click)
                            end

                            tp(originalCF)
                        end
                    end
                end
            end

            task.wait(0.15)
        end
    end)
end

-------------------------------------------------------
-- AUTO ULTRA PUNISH LOOP
-------------------------------------------------------
local autoUltra = false
local ultraThread = nil

local function runUltraLoop()
    ultraThread = task.spawn(function()
        while autoUltra do
            local originalCF = getHrp().CFrame

            for _, booth in ipairs(workspace.ConfessionalBooths:GetChildren()) do
                if not autoUltra then
                    break
                end

                local button = booth:FindFirstChild('punishButton')
                if button and button:IsA('BasePart') then
                    if button.BrickColor == BrickColor.new('Really red') then
                        local click =
                            button:FindFirstChildWhichIsA('ClickDetector')
                        if click then
                            -- TP under button
                            tp(
                                CFrame.new(
                                    button.Position - Vector3.new(0, 3, 0)
                                )
                            )
                            task.wait(0.1)

                            for i = 1, spamAmount do
                                fireclickdetector(click)
                            end

                            task.wait(7)

                            -- return to original position
                            tp(originalCF)
                        end
                    end
                end
            end

            task.wait(0.1)
        end
    end)
end

-------------------------------------------------------
-- MAIN WINDOW
-------------------------------------------------------

local tab = win:Tab({
    Title = 'Features',
})

local sec = tab:Section({
    Title = "⚠️ Spam above 10,000 doesn't do anything",
})

-------------------------------------------------------
-- AUTO PUNISH TOGGLE
-------------------------------------------------------
sec:Toggle({
    Title = 'Auto Punish',
    Default = false,
    Callback = function(state)
        autoPunish = state
        if state then
            runPunishLoop()
        end
    end,
})

-------------------------------------------------------
-- AUTO ULTRA PUNISH TOGGLE
-------------------------------------------------------
sec:Toggle({
    Title = 'Auto Ultra Punish',
    Default = false,
    Callback = function(state)
        autoUltra = state
        if state then
            runUltraLoop()
        end
    end,
})

-------------------------------------------------------
-- AUTO FORGIVE TOGGLE
-------------------------------------------------------
sec:Toggle({
    Title = 'Auto Forgive',
    Default = false,
    Callback = function(state)
        autoForgive = state
        if state then
            runForgiveLoop()
        end
    end,
})

-------------------------------------------------------
-- MANUAL PROXIMITY PUNISH BUTTON
-------------------------------------------------------
sec:Button({
    Title = 'Ultra Punish (~10 sin per spam)',
    Callback = function()
        local hrp = getHrp()

        for _, booth in ipairs(workspace.ConfessionalBooths:GetChildren()) do
            local button = booth:FindFirstChild('punishButton')
            if button and button:IsA('BasePart') then
                local dist = (hrp.Position - button.Position).Magnitude
                if dist <= 10 then
                    if button.BrickColor == BrickColor.new('Really red') then
                        local click =
                            button:FindFirstChildWhichIsA('ClickDetector')
                        if click then
                            -- spam using input box value
                            for i = 1, spamAmount do
                                fireclickdetector(click)
                            end

                            break
                        end
                    end
                end
            end
        end
    end,
})

-------------------------------------------------------
-- SPAM AMOUNT INPUT BOX
-------------------------------------------------------
sec:Input({
    Title = 'Spam Amount',
    Default = '1',
    Placeholder = 'Enter number of clicks',
    Callback = function(text)
        local num = tonumber(text)
        if num and num > 0 then
            spamAmount = math.floor(num)
        end
    end,
})
